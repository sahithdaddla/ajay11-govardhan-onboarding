<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Onboarding Details</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #ffffff;
            color: #333;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .banner-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .circle:nth-child(1) {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
        }

        .circle:nth-child(2) {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: -50px;
        }

        .circle:nth-child(3) {
            width: 150px;
            height: 150px;
            bottom: 100px;
            right: 50px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .filters-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .left-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 0.9rem;
            min-width: 180px;
        }

        .search-container {
            position: relative;
            flex-grow: 1;
            max-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 1rem;
            padding-left: 2.5rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23999' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 0.8rem center;
            background-size: 1rem;
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .employee-card {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
    width: 100%;
    display: flex;
    flex-direction: column;
    min-height: 400px; /* Set minimum height for consistency */
}


        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    background-color: #f9fafb;
    border-bottom: 1px solid #eee;
    flex-shrink: 0; /* Prevent header from shrinking */
}

        .profile-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #4f46e5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-initials {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4f46e5;
            color: white;
        }

        .employee-info {
            flex-grow: 1;
        }

        .employee-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
            color: #111827;
        }

        .job-role {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .card-body {
    padding: 1.5rem;
    flex-grow: 1; /* Allow body to grow and fill space */
    display: flex;
    flex-direction: column;
}

.info-row {
    display: flex;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
    align-items: flex-start; /* Align items to top */
}

.info-label {
    color: #6b7280;
    font-weight: 500;
    width: 120px; /* Fixed width for labels */
    flex-shrink: 0;
    padding-right: 10px;
}

.info-value {
    color: #111827;
    flex-grow: 1;
    word-break: break-word;
    text-align: left;
}

.card-actions {
    margin-top: auto; /* Push button to bottom */
    padding-top: 1rem;
}

/* Truncate long email addresses */
.email-value {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}
        .experience-tag {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .experience-tag.fresher {
            background-color: #e0f2fe;
            color: #0369a1;
        }

        .experience-tag.experienced {
            background-color: #dcfce7;
            color: #166534;
        }


        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
            width: 100%;
        }

        .btn:hover {
            background-color: #4338ca;
        }

        .view-details {
            background-color: transparent;
            border: 1px solid #4f46e5;
            color: #4f46e5;
        }

        .view-details:hover {
            background-color: #f5f3ff;
        }

        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(79, 70, 229, 0.2);
            border-top-color: #4f46e5;
            border-radius: 50%;
            margin: 0 auto 1rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 2rem auto;
            max-width: 900px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .modal-header {
            padding: 1.5rem;
            background-color: #4f46e5;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 0.5rem;
        }

        .section-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        @media (max-width: 768px) {
            .section-grid {
                grid-template-columns: 1fr;
            }
        }

        .modal-section {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .modal-section h3 {
            margin-bottom: 1rem;
            color: #4f46e5;
            font-size: 1.1rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }

        .info-item {
            margin-bottom: 1rem;
        }

        .info-item strong {
            display: block;
            color: #6b7280;
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .info-item span {
            color: #111827;
            font-size: 0.95rem;
        }

        .documents-section {
            grid-column: 1 / -1;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .doc-btn {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .doc-btn h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .download-doc {
            color: #4f46e5;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .download-doc:hover {
            background-color: #f5f3ff;
        }

        .disabled {
            color: #9ca3af;
            cursor: not-allowed;
        }

        .modal-actions {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            text-align: right;
        }

        .modal-profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            overflow: hidden;
            background-color: #4f46e5;
            position: relative;
        }

        .modal-profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-profile-initials {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="banner-background">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
        </div>
        <h1>Employee Onboarding Details</h1>
        <p>Manage and access Employee Onboarding Details</p>
    </header>

    <div class="container">
        <div class="filters-container">
            <div class="left-filters">
                <select class="filter-dropdown" id="monthFilter">
                    <option value="">All Months</option>
                    <option value="01">January</option>
                    <option value="02">February</option>
                    <option value="03">March</option>
                    <option value="04">April</option>
                    <option value="05">May</option>
                    <option value="06">June</option>
                    <option value="07">July</option>
                    <option value="08">August</option>
                    <option value="09">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
                
                <select class="filter-dropdown" id="experienceFilter">
                    <option value="">All Experience Levels</option>
                    <option value="Fresher">Fresher</option>
                    <option value="Experienced">Experienced</option>
                </select>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search employees...">
            </div>
        </div>
        
        <div class="employee-grid" id="employee-grid">
            <div class="loading">
                <div class="spinner"></div>
                Loading employee data...
            </div>
        </div>
    </div>

    <!-- Employee Detail Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalEmployeeName"></h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <div class="modal-profile-image" id="modalProfileImage">
                        <div class="modal-profile-initials" id="modalProfileInitials"></div>
                    </div>
                    <h3>Personal Information</h3>
                    <div class="info-item">
                        <strong>Full Name</strong>
                        <span id="modalName"></span>
                    </div>
                    <div class="info-item">
                        <strong>Email Address</strong>
                        <span id="modalEmail"></span>
                    </div>
                    <div class="info-item">
                        <strong>Mobile Number</strong>
                        <span id="modalMobile"></span>
                    </div>
                    <div class="info-item">
                        <strong>Date of Birth</strong>
                        <span id="modalDob"></span>
                    </div>
                    <div class="info-item">
                        <strong>Gender</strong>
                        <span id="modalGender"></span>
                    </div>
                    <div class="info-item">
                        <strong>Marital Status</strong>
                        <span id="modalMaritalStatus"></span>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Employment Details</h3>
                    <div class="info-item">
                        <strong>Job Role</strong>
                        <span id="modalJobRole"></span>
                    </div>
                    <div class="info-item">
                        <strong>Department</strong>
                        <span id="modalDepartment"></span>
                    </div>
                    <div class="info-item">
                        <strong>Joining Date</strong>
                        <span id="modalJoiningDate"></span>
                    </div>
                    <div class="info-item">
                        <strong>Experience</strong>
                        <span id="modalExperience"></span>
                    </div>
                    <div class="info-item" id="experienceCompanyItem" style="display: none;">
                        <strong>Previous Company</strong>
                        <span id="modalExperienceCompany"></span>
                    </div>
                    <div class="info-item" id="experienceYearsItem" style="display: none;">
                        <strong>Years of Experience</strong>
                        <span id="modalExperienceYears"></span>
                    </div>
                </div>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <h3>Address Information</h3>
                    <div class="info-item">
                        <strong>Address</strong>
                        <span id="modalAddress"></span>
                    </div>
                    <div class="info-item">
                        <strong>City</strong>
                        <span id="modalCity"></span>
                    </div>
                    <div class="info-item">
                        <strong>State</strong>
                        <span id="modalState"></span>
                    </div>
                    <div class="info-item">
                        <strong>Zipcode</strong>
                        <span id="modalZipcode"></span>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Bank Details</h3>
                    <div class="info-item">
                        <strong>Bank Name</strong>
                        <span id="modalBank"></span>
                    </div>
                    <div class="info-item">
                        <strong>Account Number</strong>
                        <span id="modalAccount"></span>
                    </div>
                    <div class="info-item">
                        <strong>IFSC Code</strong>
                        <span id="modalIfsc"></span>
                    </div>
                    <div class="info-item">
                        <strong>Branch Location</strong>
                        <span id="modalBankBranch"></span>
                    </div>
                </div>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <h3>SSC Details</h3>
                    <div class="info-item">
                        <strong>SSC School</strong>
                        <span id="modalSscSchool"></span>
                    </div>
                    <div class="info-item">
                        <strong>SSC Year</strong>
                        <span id="modalSscYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>SSC Grade</strong>
                        <span id="modalSscGrade"></span>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Intermediate/Diploma</h3>
                    <div class="info-item">
                        <strong>College</strong>
                        <span id="modalInterCollege"></span>
                    </div>
                    <div class="info-item">
                        <strong>Year</strong>
                        <span id="modalInterYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>Grade</strong>
                        <span id="modalInterGrade"></span>
                    </div>
                    <div class="info-item">
                        <strong>Branch</strong>
                        <span id="modalInterBranch"></span>
                    </div>
                </div>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <h3>Graduation Details</h3>
                    <div class="info-item">
                        <strong>University</strong>
                        <span id="modalGradCollege"></span>
                    </div>
                    <div class="info-item">
                        <strong>Year</strong>
                        <span id="modalGradYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>Grade</strong>
                        <span id="modalGradGrade"></span>
                    </div>
                    <div class="info-item">
                        <strong>Degree</strong>
                        <span id="modalGradDegree"></span>
                    </div>
                    <div class="info-item">
                        <strong>Branch</strong>
                        <span id="modalGradBranch"></span>
                    </div>
                </div>
            </div>

            <div class="modal-section documents-section">
                <h3>Documents</h3>
                <div class="documents-grid" id="documentsGrid">
                    <!-- Documents will be added here -->
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn" id="downloadPdfBtn">
                    Export to PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Include jsPDF library for PDF generation -->
   <!-- Include jsPDF first -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Then include the AutoTable plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script>
       const { jsPDF } = window.jspdf;
        
    
        let currentEmployee = null;
        let allEmployees = [];
    
        // Fetch employee data
        fetch('http://44.223.23.145:3420/employees')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                allEmployees = data;
                renderEmployeeGrid(data);
                setupFilters();
                setupSearch();
            })
            .catch(error => {
                document.getElementById('employee-grid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                        Error loading data: ${error.message}
                    </div>`;
                console.error('Error fetching employee data:', error);
            });
    
        // Modal elements
        const modal = document.getElementById('employeeModal');
        const closeModal = document.getElementById('closeModal');
    
        closeModal.addEventListener('click', () => modal.style.display = 'none');
        window.addEventListener('click', (event) => {
            if (event.target === modal) modal.style.display = 'none';
        });
    
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'N/A';
            
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
    
        function getInitials(name) {
            if (!name) return '?';
            const parts = name.split(' ');
            let initials = parts[0].charAt(0).toUpperCase();
            if (parts.length > 1) {
                initials += parts[parts.length - 1].charAt(0).toUpperCase();
            }
            return initials;
        }
    
        function setupFilters() {
            const monthFilter = document.getElementById('monthFilter');
            const experienceFilter = document.getElementById('experienceFilter');
            
            monthFilter.addEventListener('change', filterEmployees);
            experienceFilter.addEventListener('change', filterEmployees);
        }
    
        function filterEmployees() {
            const monthFilter = document.getElementById('monthFilter').value;
            const experienceFilter = document.getElementById('experienceFilter').value;
            
            let filtered = allEmployees;
            
            if (monthFilter) {
                filtered = filtered.filter(emp => {
                    if (!emp.emp_joining_date) return false;
                    const joinMonth = emp.emp_joining_date.split('-')[1];
                    return joinMonth === monthFilter;
                });
            }
            
            if (experienceFilter) {
                filtered = filtered.filter(emp => {
                    if (experienceFilter === 'Fresher') {
                        return !emp.emp_experience_status || emp.emp_experience_status === 'Fresher' || emp.emp_years_of_experience === 0;
                    } else {
                        return emp.emp_experience_status === 'Experienced' && emp.emp_years_of_experience > 0;
                    }
                });
            }
            
            renderEmployeeGrid(filtered);
        }
    
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length === 0) {
                    filterEmployees();
                    return;
                }
                
                const filtered = allEmployees.filter(emp => 
                    emp.emp_name.toLowerCase().includes(searchTerm) ||
                    emp.emp_email.toLowerCase().includes(searchTerm) ||
                    (emp.emp_job_role && emp.emp_job_role.toLowerCase().includes(searchTerm)) ||
                    (emp.emp_department && emp.emp_department.toLowerCase().includes(searchTerm)) ||
                    (emp.emp_mobile && emp.emp_mobile.toLowerCase().includes(searchTerm))
                );
                
                renderEmployeeGrid(filtered);
            });
        }
    
        // Download single document
        async function downloadDocument(docUrl) {
            try {
                if (!docUrl) {
                    alert('Document not available');
                    return;
                }
    
                const filename = docUrl.split('/').pop() || 'document';
                if (!filename) {
                    throw new Error('Could not extract filename from document URL');
                }
    
                const downloadUrl = `http://44.223.23.145:3420/download/${filename}`;
                window.open(downloadUrl, '_blank');
    
            } catch (error) {
                console.error('Download error:', error);
                alert(`Download failed: ${error.message}`);
            }
        }
    
        function renderEmployeeGrid(employees) {
    const employeeGrid = document.getElementById('employee-grid');
    employeeGrid.innerHTML = '';

    if (employees.length === 0) {
    employeeGrid.innerHTML = `
        <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
            <img src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png" alt="No data" style="width: 150px; opacity: 0.6; margin-bottom: 1rem;" />
            <div style="font-size: 1.2rem; color: #555;">No employee records found matching your criteria</div>
        </div>`;
    return;
}


    employees.forEach(employee => {
        const card = document.createElement('div');
        card.className = 'employee-card';

        // Determine experience status
        let experienceStatus;
        if (employee.emp_experience_status === 'Experienced' && employee.emp_years_of_experience > 0) {
            experienceStatus = `<span class="experience-tag experienced">${employee.emp_years_of_experience} yrs experience</span>`;
        } else {
            experienceStatus = `<span class="experience-tag fresher">Fresher</span>`;
        }

        // Create profile image element
        let profileImageHtml = '';
        if (employee.emp_profile_pic_url) {
            profileImageHtml = `
                <div class="profile-image">
                    <img src="${employee.emp_profile_pic_url}" alt="${employee.emp_name}" 
                         onerror="this.style.display='none';">
                </div>
            `;
        } else {
            profileImageHtml = `
                <div class="profile-image">
                    <img src="default-profile.png" alt="No Image" style="opacity: 0.3;">
                </div>
            `;
        }

        card.innerHTML = `
    <div class="card-header">
        ${profileImageHtml}
        <div class="employee-info">
            <h3 style="font-weight: bold;">${employee.emp_name}</h3>
            <div class="job-role">${employee.emp_job_role || 'Not specified'}</div>
        </div>
    </div>
    <div class="card-body">
        <div class="info-row">
            <span class="info-label">Joining Date</span>
            <span class="info-value">${formatDate(employee.emp_joining_date)}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Contact</span>
            <span class="info-value">${employee.emp_mobile || 'N/A'}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Gender</span>
            <span class="info-value">${employee.emp_gender || 'N/A'}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Email</span>
            <span class="info-value email-value">${employee.emp_email}</span>
        </div>
        <div class="info-row">
            <span class="info-label">Status</span>
            <span class="info-value">${experienceStatus}</span>
        </div>
        <div class="card-actions">
            <button class="btn view-details" data-email="${employee.emp_email}">
                View Details
            </button>
        </div>
    </div>
`;

        employeeGrid.appendChild(card);
    });
    
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', function() {
                    const employeeEmail = this.getAttribute('data-email');
                    const employee = allEmployees.find(emp => emp.emp_email === employeeEmail);
                    if (employee) {
                        currentEmployee = employee;
                        openEmployeeModal(employee);
                    }
                });
            });
        }
    
        function openEmployeeModal(employee) {
    if (!employee) return;

    // Helper function to safely set text content
    function setTextContent(elementId, text) {
        const element = document.getElementById(elementId);
        if (element) element.textContent = text || 'N/A';
    }

    // Reset modal elements safely
    const modalProfileImage = document.getElementById('modalProfileImage');
    const modalProfileInitials = document.getElementById('modalProfileInitials');

    // Clear previous content safely
    if (modalProfileImage) {
        modalProfileImage.innerHTML = '';
    }

    // Set initials safely
    if (modalProfileInitials) {
        modalProfileInitials.textContent = getInitials(employee.emp_name);
        modalProfileInitials.style.display = 'flex'; // Always show initials by default
    }

    // Load profile image if URL exists
    if (employee.emp_profile_pic_url && modalProfileImage) {
        const img = document.createElement('img');
        img.src = employee.emp_profile_pic_url;
        img.alt = employee.emp_name;
        img.onerror = () => {
            img.style.display = 'none';
            if (modalProfileInitials) modalProfileInitials.style.display = 'flex';
        };
        modalProfileImage.appendChild(img);
        if (modalProfileInitials) modalProfileInitials.style.display = 'none';
    }

    // Set basic info using safe function
    setTextContent('modalEmployeeName', employee.emp_name);
    setTextContent('modalName', employee.emp_name);
    setTextContent('modalEmail', employee.emp_email);
    setTextContent('modalMobile', employee.emp_mobile);
    setTextContent('modalDob', formatDate(employee.emp_dob));
    setTextContent('modalJobRole', employee.emp_job_role);
    setTextContent('modalDepartment', employee.emp_department);
    setTextContent('modalJoiningDate', formatDate(employee.emp_joining_date));

    // Set experience details safely
    const experienceItem = document.getElementById('modalExperience');
    const companyItem = document.getElementById('experienceCompanyItem');
    const companyValue = document.getElementById('modalExperienceCompany');
    const yearsItem = document.getElementById('experienceYearsItem');
    const yearsValue = document.getElementById('modalExperienceYears');

    if (experienceItem && companyItem && companyValue && yearsItem && yearsValue) {
        if (employee.emp_experience_status === 'Experienced' && employee.emp_years_of_experience > 0) {
            experienceItem.textContent = 'Experienced';
            companyValue.textContent = employee.emp_company_name || 'Not specified';
            yearsValue.textContent = employee.emp_years_of_experience;
            companyItem.style.display = 'block';
            yearsItem.style.display = 'block';
        } else {
            experienceItem.textContent = 'Fresher';
            companyItem.style.display = 'none';
            yearsItem.style.display = 'none';
        }
    }

    // Set address info safely
    setTextContent('modalAddress', employee.emp_address);
    setTextContent('modalCity', employee.emp_city);
    setTextContent('modalState', employee.emp_state);
    setTextContent('modalZipcode', employee.emp_zipcode);
    setTextContent('modalGender', employee.emp_gender || 'N/A');
    setTextContent('modalMaritalStatus', employee.emp_marital_status || 'N/A');

    // Set bank details safely
    setTextContent('modalBank', employee.emp_bank);
    setTextContent('modalAccount', employee.emp_account);
    setTextContent('modalIfsc', employee.emp_ifsc);
    setTextContent('modalBankBranch', employee.emp_bank_branch);

    // Set education details safely
    setTextContent('modalSscSchool', employee.ssc_school);
    setTextContent('modalSscYear', employee.ssc_year);
    setTextContent('modalSscGrade', employee.ssc_grade);
    setTextContent('modalInterCollege', employee.inter_college);
    setTextContent('modalInterYear', employee.inter_year);
    setTextContent('modalInterGrade', employee.inter_grade);
    setTextContent('modalInterBranch', employee.inter_branch);
    setTextContent('modalGradCollege', employee.grad_college);
    setTextContent('modalGradYear', employee.grad_year);
    setTextContent('modalGradGrade', employee.grad_grade);
    setTextContent('modalGradDegree', employee.grad_degree);
    setTextContent('modalGradBranch', employee.grad_branch);

    // Set up documents safely
    const documentsGrid = document.getElementById('documentsGrid');
    if (documentsGrid) {
        documentsGrid.innerHTML = '';

        const documents = [
            { name: 'Profile Picture', url: employee.emp_profile_pic_url },
            { name: 'SSC Certificate', url: employee.emp_ssc_doc_url },
            { name: 'Intermediate/Diploma', url: employee.emp_inter_doc_url },
            { name: 'Graduation Certificate', url: employee.emp_grad_doc_url },
            { name: 'Resume', url: employee.resume_url },
            { name: 'ID Proof', url: employee.id_proof_url },
            { name: 'Signed Document', url: employee.signed_document_url }
        ];

        if (employee.emp_experience_status === 'Experienced') {
            documents.push(
                { name: 'Offer Letter', url: employee.emp_offer_letter_url },
                { name: 'Relieving Letter', url: employee.emp_relieving_letter_url },
                { name: 'Experience Certificate', url: employee.emp_experience_certificate_url },
                { name: 'Salary Slip', url: employee.emp_salary_slip_url }
            );
        }

        documents.forEach(doc => {
            const docElement = document.createElement('div');
            docElement.className = 'doc-btn';
            
            if (doc.url) {
                docElement.innerHTML = `
                    <h4>${doc.name}</h4>
                    <a href="#" class="download-doc" data-url="${doc.url}">Download</a>
                `;
            } else {
                docElement.innerHTML = `
                    <h4>${doc.name}</h4>
                    <a href="#" class="disabled" disabled>Not Available</a>
                `;
            }
            documentsGrid.appendChild(docElement);
        });

        // Reattach event listeners safely
        setTimeout(() => {
            document.querySelectorAll('.download-doc').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const docUrl = this.getAttribute('data-url');
                    if (docUrl) downloadDocument(docUrl);
                });
            });
        }, 0);
    }

    // Set PDF button safely
    const pdfBtn = document.getElementById('downloadPdfBtn');
    if (pdfBtn) {
        pdfBtn.onclick = () => generateEmployeePDF(employee);
    }

    // Show modal safely
    const modal = document.getElementById('employeeModal'); // Make sure this exists
    if (modal) modal.style.display = 'block';
}
    
        function generateEmployeePDF(employee) {
    if (!employee) return;

    const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm'
    });

    doc.setFont('helvetica','bold');

    // Add top header: Employee Name
    doc.setFontSize(23);
    doc.setTextColor(74, 31, 5);
    doc.text(employee.emp_name || 'Employee Profile', 105, 15, { align: 'center' });
    doc.setFontSize(10);
    doc.text(`ID: ${employee.id}`, 105, 20, { align: 'center' });
    doc.line(20, 22, 190, 22);

    const blueColor = [13, 0, 255]; // Updated background color: #0d00ff
    const bodyStyle = {
        fontSize: 10,
        cellPadding: 3,
        overflow: 'linebreak',
        minCellHeight: 6
    };

    const headerStyle = {
        fillColor: blueColor,
        textColor: [255, 255, 255],
        halign: 'center',
        valign: 'middle',
        fontStyle: 'bold',
        fontSize: 12,
        cellPadding: 4
    };

    const loadProfileImage = new Promise((resolve) => {
        if (employee.emp_profile_pic_url) {
            const img = new Image();
            img.crossOrigin = 'Anonymous';
            img.src = employee.emp_profile_pic_url;
            img.onload = function() {
                resolve(img);
            };
            img.onerror = function() {
                console.error("Error loading profile image");
                resolve(null);
            };
        } else {
            resolve(null);
        }
    });

    function getInitials(name) {
        if (!name) return 'NA';
        const parts = name.split(' ');
        return parts.map(p => p.charAt(0).toUpperCase()).join('');
    }

    loadProfileImage.then((img) => {
        let startY = 30;

        // Personal Details and Profile Image (Side by side)
        const personalDetails = [
            ['Name:' , employee.emp_name || 'N/A'],
            ['Email:', employee.emp_email || 'N/A'],
            ['Gender:', employee.emp_gender || 'N/A'],
            ['Marital Status:', employee.emp_marital_status || 'N/A'],
            ['DOB:', employee.emp_dob ? new Date(employee.emp_dob).toLocaleDateString() : 'N/A'],
            ['Mobile:', employee.emp_mobile || 'N/A'],
            ['Job Role:', employee.emp_job_role || 'N/A'],
            ['Department:', employee.emp_department || 'N/A'],
            ['Experience:', employee.emp_experience_status || 'N/A'],
            ['Joining Date:', employee.emp_joining_date ? new Date(employee.emp_joining_date).toLocaleDateString() : 'N/A']
        ];

        // Draw personal details table (60% width)
        doc.autoTable({
            startY,
            margin: { left: 14 },
            tableWidth: 110,
            body: personalDetails,
            styles: bodyStyle,
            headStyles: headerStyle,
            columnStyles: {
                0: { fontStyle: 'bold', cellWidth: 40 },
                1: { cellWidth: 'auto' }
            },
            theme: 'grid'
        });

        const personalTableEndY = doc.lastAutoTable.finalY;

        // Draw Profile Image (Right side)
        if (img) {
            const ratio = img.height / img.width;
            const imgWidth = 40;
            const imgHeight = imgWidth * ratio;
            const imageX = 140;
            const imageY = startY + 5;
            doc.addImage(img, 'JPEG', imageX, imageY, imgWidth, imgHeight);
        } else {
            // Draw initials fallback
            doc.setFillColor(200, 200, 200);
            doc.circle(160, startY + 20, 20, 'F');
            doc.setFontSize(14);
            doc.setTextColor(100, 100, 100);
            doc.text(getInitials(employee.emp_name), 160, startY + 24, { align: 'center' });
        }

        startY = personalTableEndY + 15;

        // Helper function to draw sections
        const createFullWidthTable = (title, body) => {
            // Section title
            doc.setFontSize(12);
            doc.setFillColor(...blueColor);
            doc.setTextColor(255, 255, 255);
            doc.rect(14, startY - 5, 182, 8, 'F');
            doc.text(title, 105, startY, { align: 'center' });

            // Actual Table
            doc.autoTable({
                startY: startY + 5,
                margin: { left: 14, right: 14 },
                tableWidth: 182,
                body: body,
                styles: bodyStyle,
                headStyles: headerStyle,
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 50 },
                    1: { cellWidth: 'auto' }
                },
                theme: 'grid'
            });

            startY = doc.lastAutoTable.finalY + 15;
        };

        // Address Section
        createFullWidthTable('Address Information', [
            ['Address:', employee.emp_address || 'N/A'],
            ['City:', employee.emp_city || 'N/A'],
            ['State:', employee.emp_state || 'N/A'],
            ['Zipcode:', employee.emp_zipcode || 'N/A']
        ]);

        // Bank Details Section
        createFullWidthTable('Bank Details', [
            ['Bank Name:', employee.emp_bank || 'N/A'],
            ['Account No:', employee.emp_account || 'N/A'],
            ['IFSC Code:', employee.emp_ifsc || 'N/A'],
            ['Branch:', employee.emp_bank_branch || 'N/A']
        ]);
        createFullWidthTable('Experinece Details', [
            ['Pervious Company Name:', employee.emp_company_name || 'N/A'],
            ['Years Of Experinece:', employee.emp_years_of_experience || 'N/A'],
           
        ]);
        // Graduation Education Section
        createFullWidthTable('Graduation Details', [
            ['University:', employee.grad_college || 'N/A'],
            ['Year:', employee.grad_year || 'N/A'],
            ['Grade:', employee.grad_grade || 'N/A'],
            ['Degree:', employee.grad_degree || 'N/A'],
            ['Branch:', employee.grad_branch || 'N/A']
        ]);
        // Intermediate / Diploma Section
        createFullWidthTable('Intermediate / Diploma Education', [
            ['College:', employee.inter_college || 'N/A'],
            ['Year:', employee.inter_year || 'N/A'],
            ['Grade:', employee.inter_grade || 'N/A'],
            ['Branch:', employee.inter_branch || 'N/A']
        ]);

        // SSC Details Section
        createFullWidthTable('SSC Education', [
            ['School:', employee.ssc_school || 'N/A'],
            ['Year:', employee.ssc_year || 'N/A'],
            ['Grade:', employee.ssc_grade || 'N/A'],
        ]);

        // Documents Section
        const documents = [
            ['Profile Picture', employee.emp_profile_pic_url ? 'Available' : 'Not Available'],
            ['SSC Certificate', employee.emp_ssc_doc_url ? 'Available' : 'Not Available'],
            ['Intermediate/Diploma', employee.emp_inter_doc_url ? 'Available' : 'Not Available'],
            ['Graduation Certificate', employee.emp_grad_doc_url ? 'Available' : 'Not Available'],
            ['Resume', employee.resume_url ? 'Available' : 'Not Available'],
            ['ID Proof', employee.id_proof_url ? 'Available' : 'Not Available'],
            ['Signed Document', employee.signed_document_url ? 'Available' : 'Not Available']
        ];

        if (employee.emp_experience_status === 'Experienced') {
            documents.push(
                ['Offer Letter', employee.emp_offer_letter_url ? 'Available' : 'Not Available'],
                ['Relieving Letter', employee.emp_relieving_letter_url ? 'Available' : 'Not Available'],
                ['Experience Certificate', employee.emp_experience_certificate_url ? 'Available' : 'Not Available'],
                ['Salary Slip', employee.emp_salary_slip_url ? 'Available' : 'Not Available']
            );
        }

        // Documents Section Heading
        doc.setFontSize(12);
        doc.setFillColor(...blueColor);
        doc.setTextColor(255, 255, 255);
        doc.rect(14, startY - 5, 182, 8, 'F');
        doc.text('Documents', 105, startY, { align: 'center' });

        // Documents Table
        doc.autoTable({
            startY: startY + 5,
            margin: { left: 14, right: 14 },
            tableWidth: 182,
            body: documents,
            styles: bodyStyle,
            headStyles: headerStyle,
            columnStyles: {
                0: { fontStyle: 'bold', cellWidth: 80 },
                1: { halign: 'center', cellWidth: 'auto' }
            },
            theme: 'grid',
            willDrawCell: (data) => {
                if (data.section === 'body' && data.column.index === 1) {
                    if (data.cell.raw === 'Available') {
                        data.cell.styles.fillColor = [220, 252, 231]; // Green background
                        data.cell.styles.textColor = [22, 101, 52];
                    } else {
                        data.cell.styles.fillColor = [254, 226, 226]; // Red background
                        data.cell.styles.textColor = [153, 27, 27];
                    }
                }
            }
        });

        // Footer
        const footerY = doc.internal.pageSize.height - 15;
        doc.setFontSize(8);
        doc.setTextColor(150, 150, 150);
        doc.text('Generated by Astrolite Tech Solutions', 105, footerY, { align: 'center' });
        doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, footerY + 5, { align: 'center' });

        // Save PDF
        doc.save(`Employee_${employee.emp_name.replace(/\s+/g, '_')}_Profile.pdf`);
    });
}

        </script>
    </body>
    </html>
